# ğŸ›ï¸ FINARVA ARCHITECTURE DOCUMENTATION

Complete architectural overview of the Finarva AI-powered financial platform.

---

## ğŸ“Š Table of Contents

1. [System Architecture](#system-architecture)
2. [Component Architecture](#component-architecture)
3. [Data Flow](#data-flow)
4. [Deployment Architecture](#deployment-architecture)
5. [Security Architecture](#security-architecture)
6. [Scalability & Performance](#scalability--performance)

---

## ğŸ—ï¸ System Architecture

### High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          CLIENT LAYER                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Web Client  â”‚  â”‚ Mobile App  â”‚  â”‚  3rd Party  â”‚                  â”‚
â”‚  â”‚   (React)   â”‚  â”‚   (React    â”‚  â”‚     API     â”‚                  â”‚
â”‚  â”‚             â”‚  â”‚   Native)   â”‚  â”‚  Consumers  â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                 â”‚                 â”‚
          â”‚            HTTPS/TLS              â”‚
          â”‚                 â”‚                 â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   API GATEWAY / LOAD BALANCER                          â”‚
â”‚                    (Nginx / Azure Load Balancer)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     APPLICATION LAYER                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚              FINARVA API (NestJS)                          â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚       â”‚
â”‚  â”‚  â”‚  Controllers (REST Endpoints)                       â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â€¢ Auth   â€¢ Clients  â€¢ Expenses  â€¢ Investments      â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â€¢ AI     â€¢ Loans    â€¢ Insurance â€¢ Analytics        â”‚  â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚       â”‚
â”‚  â”‚                   â”‚                                        â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚       â”‚
â”‚  â”‚  â”‚  Business Logic Layer (Services)                    â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â€¢ Authentication & Authorization (JWT)             â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â€¢ AI Service (OpenAI, Gemini)                      â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â€¢ Financial Analytics                              â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â€¢ Business Logic & Validation                      â”‚  â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚       â”‚
â”‚  â”‚                   â”‚                                        â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚       â”‚
â”‚  â”‚  â”‚  Data Access Layer (Prisma ORM)                     â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â€¢ Repository Pattern                               â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â€¢ Query Optimization                               â”‚  â”‚       â”‚
â”‚  â”‚  â”‚  â€¢ Transaction Management                           â”‚  â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATA & CACHE LAYER                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ PostgreSQL  â”‚  â”‚    Redis    â”‚  â”‚  Pinecone   â”‚                   â”‚
â”‚  â”‚  Database   â”‚  â”‚    Cache    â”‚  â”‚  Vector DB  â”‚                   â”‚
â”‚  â”‚             â”‚  â”‚  & Session  â”‚  â”‚  (AI RAG)   â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EXTERNAL SERVICES                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚   OpenAI    â”‚  â”‚   Google    â”‚  â”‚   Stripe    â”‚                   â”‚
â”‚  â”‚   GPT-4     â”‚  â”‚  Gemini Pro â”‚  â”‚  Payments   â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  BACKGROUND JOBS & QUEUE                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  BullMQ Job Queue (Redis-backed)                       â”‚           â”‚
â”‚  â”‚  â€¢ Email Notifications  â€¢ Report Generation            â”‚           â”‚
â”‚  â”‚  â€¢ Data Aggregation     â€¢ Scheduled Tasks              â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  MONITORING & LOGGING                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ Application â”‚  â”‚     Log     â”‚  â”‚   Health    â”‚                   â”‚
â”‚  â”‚  Insights   â”‚  â”‚  Analytics  â”‚  â”‚   Checks    â”‚                   â”‚
â”‚  â”‚   (Azure)   â”‚  â”‚  Workspace  â”‚  â”‚             â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© Component Architecture

### NestJS Module Structure

```
AppModule (Root)
â”‚
â”œâ”€â”€ AuthModule
â”‚   â”œâ”€â”€ AuthController
â”‚   â”œâ”€â”€ AuthService
â”‚   â”œâ”€â”€ JwtStrategy
â”‚   â”œâ”€â”€ RefreshTokenStrategy
â”‚   â””â”€â”€ Guards (JwtAuthGuard, RolesGuard)
â”‚
â”œâ”€â”€ AIModule
â”‚   â”œâ”€â”€ AIController
â”‚   â”œâ”€â”€ AIService (OpenAI, Gemini integration)
â”‚   â”œâ”€â”€ AIProcessor (BullMQ consumer)
â”‚   â””â”€â”€ VectorStoreModule (Pinecone)
â”‚
â”œâ”€â”€ ClientsModule
â”‚   â”œâ”€â”€ ClientsController
â”‚   â”œâ”€â”€ ClientsService
â”‚   â””â”€â”€ DTOs (Create, Update, Query)
â”‚
â”œâ”€â”€ ExpensesModule
â”‚   â”œâ”€â”€ ExpensesController
â”‚   â”œâ”€â”€ ExpensesService
â”‚   â””â”€â”€ DTOs
â”‚
â”œâ”€â”€ InvestmentModule
â”‚   â”œâ”€â”€ InvestmentController
â”‚   â”œâ”€â”€ InvestmentService
â”‚   â””â”€â”€ DTOs
â”‚
â”œâ”€â”€ LoansModule
â”‚   â”œâ”€â”€ LoansController
â”‚   â”œâ”€â”€ LoansService
â”‚   â””â”€â”€ DTOs
â”‚
â”œâ”€â”€ InsuranceModule
â”‚   â”œâ”€â”€ InsuranceController
â”‚   â”œâ”€â”€ InsuranceService
â”‚   â””â”€â”€ DTOs
â”‚
â”œâ”€â”€ CashFlowModule
â”‚   â”œâ”€â”€ CashFlowController
â”‚   â”œâ”€â”€ CashFlowService
â”‚   â””â”€â”€ Analytics
â”‚
â”œâ”€â”€ InventoryModule
â”‚   â”œâ”€â”€ InventoryController
â”‚   â”œâ”€â”€ InventoryService
â”‚   â””â”€â”€ DTOs
â”‚
â”œâ”€â”€ LearningModule
â”‚   â”œâ”€â”€ LearningController
â”‚   â”œâ”€â”€ LearningService
â”‚   â””â”€â”€ DTOs
â”‚
â”œâ”€â”€ QuizModule
â”‚   â”œâ”€â”€ QuizController
â”‚   â”œâ”€â”€ QuizService
â”‚   â””â”€â”€ DTOs
â”‚
â”œâ”€â”€ MerchantAssistantModule
â”‚   â”œâ”€â”€ MerchantAssistantController
â”‚   â”œâ”€â”€ MerchantAssistantService
â”‚   â””â”€â”€ RAG Pipeline
â”‚
â”œâ”€â”€ ReportingModule
â”‚   â”œâ”€â”€ ReportingController
â”‚   â”œâ”€â”€ ReportingService
â”‚   â””â”€â”€ Analytics
â”‚
â”œâ”€â”€ HealthModule
â”‚   â”œâ”€â”€ HealthController
â”‚   â””â”€â”€ Health Indicators (Database, Redis, Disk, Memory)
â”‚
â”œâ”€â”€ PrismaModule (Global)
â”‚   â””â”€â”€ PrismaService
â”‚
â””â”€â”€ CommonModule
    â”œâ”€â”€ Filters (Exception, Validation)
    â”œâ”€â”€ Interceptors (Logging, Transform, Timeout)
    â”œâ”€â”€ Pipes (Validation)
    â””â”€â”€ DTOs (Pagination, Response)
```

---

## ğŸ”„ Data Flow

### Authentication Flow

```
1. User Login Request
   â”‚
   â”œâ”€> POST /api/v1/auth/login
   â”‚   { email, password }
   â”‚
   â”œâ”€> AuthController.login()
   â”‚
   â”œâ”€> AuthService.validateUser()
   â”‚   â”œâ”€> PrismaService.findUser()
   â”‚   â””â”€> bcrypt.compare(password, hashedPassword)
   â”‚
   â”œâ”€> AuthService.generateTokens()
   â”‚   â”œâ”€> JWT Access Token (15min)
   â”‚   â””â”€> JWT Refresh Token (7 days)
   â”‚
   â”œâ”€> Store refresh token in Redis
   â”‚   â””â”€> RedisService.set(userId, refreshToken)
   â”‚
   â””â”€> Response
       {
         accessToken: "...",
         refreshToken: "...",
         user: { ... }
       }

2. Authenticated Request
   â”‚
   â”œâ”€> GET /api/v1/clients
   â”‚   Header: Authorization: Bearer <accessToken>
   â”‚
   â”œâ”€> JwtAuthGuard.canActivate()
   â”‚   â”œâ”€> JWT Verification
   â”‚   â”œâ”€> Extract user from token
   â”‚   â””â”€> Attach to request.user
   â”‚
   â”œâ”€> ClientsController.findAll()
   â”‚
   â”œâ”€> ClientsService.findAll(userId)
   â”‚
   â”œâ”€> PrismaService.findMany({ where: { userId } })
   â”‚
   â””â”€> Response: [ { client1 }, { client2 }, ... ]

3. Token Refresh
   â”‚
   â”œâ”€> POST /api/v1/auth/refresh
   â”‚   { refreshToken }
   â”‚
   â”œâ”€> Verify refresh token
   â”‚
   â”œâ”€> Check Redis for valid session
   â”‚
   â”œâ”€> Generate new access token
   â”‚
   â””â”€> Response: { accessToken }
```

### AI Request Flow (Merchant Assistant)

```
1. AI Query Request
   â”‚
   â”œâ”€> POST /api/v1/merchant-assistant/ask
   â”‚   { query: "How do I improve cash flow?" }
   â”‚
   â”œâ”€> MerchantAssistantController.ask()
   â”‚
   â”œâ”€> Check Redis cache
   â”‚   â””â”€> Cache key: md5(query)
   â”‚   â””â”€> If cached: return cached response
   â”‚
   â”œâ”€> RAG Pipeline (if not cached)
   â”‚   â”‚
   â”‚   â”œâ”€> Query Embedding
   â”‚   â”‚   â””â”€> OpenAI Embeddings API
   â”‚   â”‚       â””â”€> Vector: [0.123, -0.456, ...]
   â”‚   â”‚
   â”‚   â”œâ”€> Vector Search
   â”‚   â”‚   â””â”€> Pinecone.query(vector)
   â”‚   â”‚       â””â”€> Top 5 relevant documents
   â”‚   â”‚
   â”‚   â”œâ”€> Context Augmentation
   â”‚   â”‚   â””â”€> Combine: user query + relevant docs
   â”‚   â”‚
   â”‚   â”œâ”€> LLM Generation
   â”‚   â”‚   â”œâ”€> Try OpenAI GPT-4
   â”‚   â”‚   â”‚   â””â”€> If fails: fallback to Gemini
   â”‚   â”‚   â””â”€> Generate response
   â”‚   â”‚
   â”‚   â””â”€> Response Post-processing
   â”‚       â””â”€> Format, sanitize, validate
   â”‚
   â”œâ”€> Cache response in Redis
   â”‚   â””â”€> TTL: 1 hour
   â”‚
   â””â”€> Response
       {
         answer: "To improve cash flow...",
         sources: [...],
         confidence: 0.95
       }
```

### Background Job Flow

```
1. Enqueue Job
   â”‚
   â”œâ”€> Service calls: queue.add('generate-report', data)
   â”‚
   â”œâ”€> BullMQ adds job to Redis queue
   â”‚
   â””â”€> Returns job ID

2. Job Processing
   â”‚
   â”œâ”€> Worker polls Redis queue
   â”‚
   â”œâ”€> Pick up job
   â”‚
   â”œâ”€> AIProcessor.handleGenerateReport(data)
   â”‚   â”œâ”€> Fetch user data
   â”‚   â”œâ”€> Generate report with AI
   â”‚   â”œâ”€> Store in database
   â”‚   â””â”€> Send email notification
   â”‚
   â”œâ”€> Update job status
   â”‚
   â””â”€> Remove from queue (if successful)
       OR retry (if failed, max 3 attempts)
```

---

## ğŸŒ Deployment Architecture (Azure)

### Azure Infrastructure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AZURE SUBSCRIPTION                          â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Resource Group: rg-finarva-production         â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  Virtual Network: vnet-finarva-production            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Address Space: 10.0.0.0/16                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Subnet: snet-app (10.0.1.0/24)               â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                                â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  Virtual Machine                         â”‚ â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â€¢ Ubuntu 22.04 LTS                      â”‚ â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â€¢ Standard_D4s_v3                       â”‚ â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â€¢ Docker + Docker Compose               â”‚ â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â€¢ Nginx (reverse proxy + SSL)           â”‚ â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â€¢ Finarva API Container                 â”‚ â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                                â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  Network Security Group                  â”‚ â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â€¢ Allow 443 (HTTPS)                     â”‚ â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â€¢ Allow 80 (HTTP -> redirect)           â”‚ â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â€¢ Allow 22 (SSH - whitelisted IPs)      â”‚ â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  Public IP: pip-finarva-production                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Static allocation                                 â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ DNS: api.finarva.com                              â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  Azure Redis Cache: redis-finarva-production         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Standard tier, 6GB                                â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ TLS encryption                                    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Private endpoint                                  â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  Azure PostgreSQL Flexible Server (Optional)         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ General Purpose, 4 vCores                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ 128GB storage                                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Auto-backups (7 days retention)                   â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  Storage Account: stfinarvaproduction                â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Blob containers for backups                       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ File shares for logs                              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Geo-redundant storage                             â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  Application Insights: appi-finarva-production       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Performance monitoring                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Error tracking                                    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Custom metrics                                    â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  Log Analytics Workspace                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Centralized logging                               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Query and analysis                                â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â€¢ Alerts and dashboards                             â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”’ Security Architecture

### Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              LAYER 1: NETWORK SECURITY                   â”‚
â”‚  â€¢ Azure NSG (Network Security Group)                   â”‚
â”‚  â€¢ IP Whitelisting for SSH                              â”‚
â”‚  â€¢ DDoS protection                                       â”‚
â”‚  â€¢ Private endpoints for Azure services                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              LAYER 2: TRANSPORT SECURITY                 â”‚
â”‚  â€¢ TLS 1.3 encryption (Let's Encrypt)                   â”‚
â”‚  â€¢ HSTS (HTTP Strict Transport Security)                â”‚
â”‚  â€¢ Certificate auto-renewal                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         LAYER 3: APPLICATION SECURITY                    â”‚
â”‚  â€¢ Helmet.js security headers                           â”‚
â”‚  â€¢ CORS configuration                                   â”‚
â”‚  â€¢ Rate limiting (100 req/min)                          â”‚
â”‚  â€¢ Request size limits                                  â”‚
â”‚  â€¢ XSS protection                                       â”‚
â”‚  â€¢ CSRF protection                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         LAYER 4: AUTHENTICATION & AUTHORIZATION          â”‚
â”‚  â€¢ JWT with RS256 algorithm                             â”‚
â”‚  â€¢ Access tokens (15min expiry)                         â”‚
â”‚  â€¢ Refresh tokens (7 days, Redis-backed)                â”‚
â”‚  â€¢ Role-based access control (RBAC)                     â”‚
â”‚  â€¢ Password hashing (bcrypt, 10 rounds)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              LAYER 5: DATA SECURITY                      â”‚
â”‚  â€¢ Encrypted database connections (SSL/TLS)             â”‚
â”‚  â€¢ Redis TLS encryption                                 â”‚
â”‚  â€¢ Environment variable encryption                      â”‚
â”‚  â€¢ Secrets in Azure Key Vault                           â”‚
â”‚  â€¢ Database backups encryption                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            LAYER 6: MONITORING & AUDIT                   â”‚
â”‚  â€¢ Application Insights logging                         â”‚
â”‚  â€¢ Security event tracking                              â”‚
â”‚  â€¢ Audit trails for sensitive operations                â”‚
â”‚  â€¢ Anomaly detection                                    â”‚
â”‚  â€¢ Alert notifications                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš¡ Scalability & Performance

### Horizontal Scaling Strategy

```
Load Balancer (Azure LB / App Gateway)
    â”‚
    â”œâ”€â”€â”€ VM Instance 1 (Auto-scaled)
    â”‚    â””â”€â”€â”€ Docker: Finarva API
    â”‚
    â”œâ”€â”€â”€ VM Instance 2 (Auto-scaled)
    â”‚    â””â”€â”€â”€ Docker: Finarva API
    â”‚
    â””â”€â”€â”€ VM Instance N (Auto-scaled)
         â””â”€â”€â”€ Docker: Finarva API

         All sharing:
         â€¢ Redis Cache (session affinity)
         â€¢ PostgreSQL (connection pooling)
         â€¢ Azure Storage
```

### Performance Optimizations

1. **Caching Strategy**
   - Redis caching for frequently accessed data
   - Cache TTL based on data volatility
   - Cache invalidation on updates

2. **Database Optimization**
   - Prisma query optimization
   - Database indexing on frequently queried fields
   - Connection pooling (max 100 connections)
   - Read replicas for read-heavy operations

3. **API Optimization**
   - Response compression (gzip)
   - Pagination for large datasets
   - Field selection to minimize payload
   - Rate limiting to prevent abuse

4. **Background Processing**
   - BullMQ for async operations
   - Job prioritization
   - Retry logic with exponential backoff

---

## ğŸ“ˆ Monitoring Dashboard

### Key Metrics Tracked

```
Application Performance
â”œâ”€â”€ Request Rate (req/sec)
â”œâ”€â”€ Response Time (p50, p95, p99)
â”œâ”€â”€ Error Rate (%)
â””â”€â”€ Throughput (MB/sec)

Infrastructure Health
â”œâ”€â”€ CPU Usage (%)
â”œâ”€â”€ Memory Usage (%)
â”œâ”€â”€ Disk I/O
â””â”€â”€ Network I/O

Business Metrics
â”œâ”€â”€ Active Users
â”œâ”€â”€ API Calls by Endpoint
â”œâ”€â”€ AI Query Volume
â””â”€â”€ Payment Transactions

Security Metrics
â”œâ”€â”€ Failed Authentication Attempts
â”œâ”€â”€ Rate Limit Violations
â”œâ”€â”€ Suspicious Activity
â””â”€â”€ Security Scan Results
```

---

**This architecture is designed for:**

- âœ… High availability (99.9% uptime)
- âœ… Horizontal scalability
- âœ… Security best practices
- âœ… Performance optimization
- âœ… Easy maintenance
- âœ… Cost efficiency

For deployment details, see [Azure Deployment Guide](infrastructure/azure/DEPLOYMENT_GUIDE.md).
